name: Discord Notifier

on:
  push:
    branches:    # change or remove to tune which branches trigger
      - main
      - webservera
      - webserverb

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send message to Discord
        env:
          WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          REPO: ${{ github.repository }}
          BRANCH: ${{ github.ref_name }}
          Pusher: ${{ github.actor }}
          COMMIT_MSG: ${{ github.event.head_commit.message || 'No commit message available' }}
          COMMIT_URL: ${{ github.event.head_commit.url || '' }}
        run: |
          payload=$(
            jq -n \
              --arg repo "$REPO" \
              --arg branch "$BRANCH" \
              --arg pusher "$Pusher" \
              --arg msg "$COMMIT_MSG" \
              --arg url "$COMMIT_URL" \
              '{content: ("ðŸ”” Repo: " + $repo + "\nâ€¢ Branch: " + $branch + "\nâ€¢ By: " + $pusher + "\nâ€¢ Message: " + $msg + (if $url != "" then "\nâ€¢ Commit: " + $url else "" end))}'
          )
          curl -s -H "Content-Type: application/json" -X POST -d "$payload" "$WEBHOOK"
