<group name="modsecurity,final_project,">

  <rule id="100100" level="0">
    <if_sid>31333, 30118</if_sid>
    <description>Ignored: Generic ModSecurity Block</description>
  </rule>

  <rule id="100200" level="0">
    <regex type="pcre2">"producer":\s*\{"modsecurity"</regex>
    <description>ModSecurity Audit Log Event (Universal Match)</description>
  </rule>

  <rule id="100201" level="12">
    <if_sid>100200</if_sid>
    <regex type="pcre2">"ruleId":"942\d{3}"</regex>
    <description>MP WAF: SQL Injection Detected</description>
    <group>web,sqli,attack,</group>
    <mitre>
      <id>T1190</id>
    </mitre>
  </rule>

  <rule id="100202" level="12">
    <if_sid>100200</if_sid>
    <regex type="pcre2">"ruleId":"(?:932|944)\d{3}"</regex>
    <description>MP WAF: Remote Command Execution (RCE) Attempt</description>
    <group>web,rce,attack,</group>
    <mitre>
      <id>T1210</id>
    </mitre>
  </rule>

  <rule id="100203" level="12">
    <if_sid>100200</if_sid>
    <regex type="pcre2">"ruleId":"941\d{3}"</regex>
    <description>MP WAF: XSS Attempt Detected</description>
    <group>web,xss,attack,</group>
    <mitre>
	<id>T1059.007</id>
    </mitre>
  </rule>

  <rule id="100204" level="12">
    <if_sid>100200</if_sid>
    <regex type="pcre2">"ruleId":"913\d{3}"</regex>
    <description>MP WAF: Security Scanner/Bot Detected (Nikto/sqlmap)</description>
    <group>web,scanner,attack,</group>
    <mitre>
      <id>T1595</id>
    </mitre>
  </rule>

  <rule id="100206" level="11">
    <if_sid>100200</if_sid>
    <regex type="pcre2">"ruleId":"949110"</regex>
    <description>MP WAF: Critical Malicious Request Blocked</description>
    <group>web,attack,blocked,</group>
  </rule>

  <rule id="100207" level="12">
    <if_sid>100200</if_sid>
    <regex type="pcre2">"ruleId":"100005"</regex>
    <description>MP WAF: AI Prompt Injection Detected</description>
    <group>web,llm,injection,attack,</group>
    <mitre>
      <id>T1598</id>
    </mitre>
  </rule>

  <rule id="100208" level="12">
    <if_sid>100200</if_sid>
    <regex type="pcre2">"ruleId":"912\d{3}"</regex>
    <description>MP WAF: Denial of Service (DoS) Burst Detected</description>
    <group>web,dos,attack,</group>
    <mitre>
      <id>T1498</id>
    </mitre>
  </rule>

  <rule id="100209" level="12">
    <if_sid>100200</if_sid>
    <regex type="pcre2">"uri":"/ollama/api/generate".*"http_code":401</regex>
    <description>MP WAF: Replay Attack / Unauthorized API Request Detected</description>
    <group>web,replay,attack,</group>
    <mitre>
      <id>T1550</id> </mitre>
  </rule>

  <rule id="100210" level="14" frequency="3" timeframe="60">
    <if_matched_sid>100209</if_matched_sid>
    <same_source_ip />
    <description>MP WAF: DDoS Flood or Brute Force Detected (High Volume of 401s)</description>
    <group>web,ddos,attack,pci_dss_11.4,</group>
    <mitre>
      <id>T1498</id> </mitre>
  </rule>

</group>

<group name="ai_integration">
  <rule id="100001" level="10">
    <decoded_as>json</decoded_as>
    <field name="integration">ollama</field>
    <description>AI Incident Analysis: $(ai_analysis)</description>
    <options>no_full_log</options>
  </rule>
</group>
